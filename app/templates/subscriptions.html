<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Twitch è¨‚é–±ç®¡ç†</title>
    <link rel="stylesheet" href="static/style.css"> <!-- âœ… å¼•å…¥å¤–éƒ¨ CSS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> <!-- âœ… å¼•å…¥ jQuery -->
</head>
<body>

    <div class="container">
        <h1>ğŸ¥ å·²è¨‚é–±çš„ Twitch å¯¦æ³ä¸»</h1>
        <ul class="streamer-list">
            {% for streamer in streamers %}
                <li class="streamer-item">
                    <a href="https://www.twitch.tv/{{ streamer }}" target="_blank">{{ streamer }}</a>
                    <form action="/unsubscribe" method="POST" class="unsubscribe-form">
                        <input type="hidden" name="broadcaster_username" value="{{ streamer }}">
                        <button type="submit" class="unsubscribe-btn">å–æ¶ˆè¨‚é–±</button>
                    </form>
                </li>
            {% endfor %}
        </ul>

        <h2>ğŸ“Œ è¨‚é–±æ–°çš„ Twitch å¯¦æ³ä¸»</h2>
        <form class="subscribe-form">
            <label>ğŸ”¹ Twitch ä½¿ç”¨è€…åç¨±ï¼š</label>
            <input type="text" name="broadcaster_username" required placeholder="è¼¸å…¥ Twitch ä½¿ç”¨è€…åç¨±">
            <button type="submit">è¨‚é–±</button>
        </form>
    </div>

    <script>
        $(document).ready(function () {
            // âœ… è¨‚é–± Twitch é »é“
            $(".subscribe-form").submit(function(event) {
                event.preventDefault();
                let username = $(this).find("input[name='broadcaster_username']").val();

                $.ajax({
                    type: "POST",
                    url: "/subscribe",
                    contentType: "application/json",
                    data: JSON.stringify({ broadcaster_username: username }),
                    success: function(response) {
                        alert(response.message);
                        location.reload();
                    },
                    error: function(xhr) {
                        alert("âŒ è¨‚é–±å¤±æ•—ï¼š" + xhr.responseJSON.message);
                    }
                });
            });

            // âœ… å–æ¶ˆè¨‚é–±
            $(".unsubscribe-form").submit(function(event) {
                event.preventDefault();
                let username = $(this).find("input[name='broadcaster_username']").val();

                $.ajax({
                    type: "POST",
                    url: "/unsubscribe",
                    contentType: "application/json",
                    data: JSON.stringify({ broadcaster_username: username }),
                    success: function(response) {
                        alert(response.message);
                        location.reload();
                    },
                    error: function(xhr) {
                        alert("âŒ å–æ¶ˆè¨‚é–±å¤±æ•—ï¼š" + xhr.responseJSON.message);
                    }
                });
            });
        });
    </script>

</body>
</html>